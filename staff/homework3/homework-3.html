<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.9.1: http://docutils.sourceforge.net/" />
<title>Homework #3</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7434 2012-05-11 21:06:27Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { /* line numbers */
  color: grey;
}

.code {
  background-color: #eeeeee
}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="homework-3">
<h1 class="title">Homework #3</h1>

<div class="section" id="introduction">
<h1>1. Introduction</h1>
<p>In this homework, you will implement a user authentication system for
your Sweng2012QuizApp application.</p>
<p>Please keep track of how many hours it takes you to solve each exercise, as we
will ask you to provide us with this information in a text file named
<tt class="docutils literal">homework_3_time_spent.txt</tt> that resides in the <tt class="docutils literal">${REPO}</tt> folder (as in
Homework #1 and Homework #2).</p>
<p>Please abide by the <a class="reference external" href="http://sweng.epfl.ch/collaboration">Collaboration Policy</a>. If you have any questions
regarding the assignment requirements, do ask on <a class="reference external" href="https://piazza.com/epfl.ch/fall2012/cs305/home">Piazza</a>. If you have any doubts
about whether it is appropriate to ask something, mark the question private. You
are allowed to use Web search to find answers to questions.</p>
<p>The deadline for this homework is <strong>Friday, November 2, 2012</strong>, at <strong>19:00</strong>.
Any assignments (or parts thereof) handed in late will not be graded.</p>
<div class="section" id="preparation">
<h2>Preparation</h2>
<p>As for all previous and future homework assignments, you should regularly commit your work, push it to your
repository, and build it on the <a class="reference external" href="http://jenkins.epfl.ch/">Jenkins</a> server.</p>
<p><a class="reference external" href="http://jenkins.epfl.ch/">Jenkins</a> will send a notification to you if the source code that you
committed does not compile or is improperly formatted.  The system will
automatically give 0 points to submissions that do not compile or
violate the <a class="reference external" href="http://sweng.epfl.ch/tutorials/checkstyle">SwEng coding style</a>. We strongly recommend that you commit
regularly before the deadline to make sure everything works as expected.</p>
</div>
<div class="section" id="basic-track-vs-full-track">
<h2>Basic track vs. Full track</h2>
<p>This homework has two parts:</p>
<ul class="simple">
<li>The basic track implements the user authentication functionality, and</li>
<li>The full track additionally adds tests to ensure the reliability of the features implemented in the basic track.</li>
</ul>
<p>The total number of points for this homework is 100. Completely and correctly solving the basic track will earn you 70 points,
while completely and correctly solving the full track will earn you 30 additional points, for a maximum of 100.</p>
</div>
</div>
<div class="section" id="basic-track-building-a-user-authentication-system">
<h1>2. [Basic Track] Building a User Authentication System</h1>
<p>In this part of Homework #2, you will implement an authentication system
that authenticates users with EPFL's Tequila system. The steps your
authentication system must follow are:</p>
<blockquote>
<ul class="simple">
<li><strong>Step 1</strong>: the Sweng2012QuizApp Android application requests an <tt class="docutils literal">authentication token</tt> from the Sweng2012QuizApp server.</li>
<li><strong>Step 2</strong>: the Sweng2012QuizApp server replies with an <tt class="docutils literal">authentication token</tt> that is obtained by the Sweng2012QuizApp server from EPFL's Tequila server.</li>
<li><strong>Step 3</strong>: the Sweng2012QuizApp Android application sends the <tt class="docutils literal">authentication token</tt> token together with the user’s credentials, i.e., <tt class="docutils literal">username</tt> and <tt class="docutils literal">password</tt>, to the Tequila server.</li>
<li><strong>Step 4</strong>: the Tequila server replies with a message describing whether the authentication succeeded or not.</li>
<li><strong>Step 5</strong>: if the authentication is successful, the Sweng2012QuizApp Android application sends the <tt class="docutils literal">authentication token</tt> received from the Sweng2012QuizApp server back to the Sweng2012QuizApp server. If the authentication is not successful, the authentication process is aborted and authentication restarts from Step 1.</li>
<li><strong>Step 6</strong>: the Sweng2012QuizApp server checks whether the <tt class="docutils literal">authentication token</tt> received from the app in Step 5 is valid by querying the Tequila server. If it is, then the Sweng2012QuizApp server replies with a <tt class="docutils literal">session id</tt>. If not, then it replies with an error message, and the authentication process must be restarted from Step 1.</li>
<li><strong>Step 7</strong>: the Sweng2012QuizApp Android application saves the <tt class="docutils literal">session id</tt> received from the server to local storage. This <tt class="docutils literal">session id</tt> will be used to authenticate all further communication between your Sweng2012QuizApp application and the Sweng2012QuizApp server.</li>
<li><strong>Step 8</strong>: the Sweng2012QuizApp Android application allows users to log out by deleting the saved <tt class="docutils literal">session id</tt>.</li>
</ul>
</blockquote>
<p>A graphical representation of this authentication process can be seen in the figure below.</p>
<div class="figure align-center">
<img alt="Authentication process using EPFL's Tequila server" src="./Homework3AuthenticationProcess.png" style="width: 800px;" />
<p class="caption">Authentication process using EPFL's Tequila server</p>
</div>
<div class="section" id="authenticating-users-30-points">
<h2>2.1. Authenticating users (30 points)</h2>
<p>In this part of the homework you will implement the authentication process described in the previous section. To achieve this, you will have to implement the communication between your Sweng2012QuizApp app and the Sweng2012QuizApp server, and between the Sweng2012QuizApp app and the Tequila server.</p>
<p>The format of the messages that are exchanged at each step is as follows.</p>
<p>In <strong>Step 1</strong>, the Android application issues a <tt class="docutils literal">GET</tt> request to the log in
functionality of the Sweng2012QuizApp server, available at <a class="reference external" href="https://sweng-quiz.appspot.com/login">https://sweng-quiz.appspot.com/login</a>.</p>
<p>In <strong>Step 2</strong>, The Sweng2012QuizApp server replies with a JSON object that has the following structure.</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">{
  <span style="color: #BA2121">&quot;token&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;rqtvk5d3za2x6ocak1a41dsmywogrdlv5&quot;</span>,
  <span style="color: #BA2121">&quot;message&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;Here&#39;s your authentication token. Please validate it</span>
<span style="color: #BA2121">              with Tequila at https://tequila.epfl.ch/cgi-bin/tequila/login&quot;</span>
}
</pre></div>
<p>The <tt class="docutils literal">token</tt> field represents a random string obtained by the Sweng2012QuizApp
server from the Tequila server, while <tt class="docutils literal">message</tt> is a debug message.</p>
<p>In <strong>Step 3</strong>, the Sweng2012QuizApp Android application issues a <tt class="docutils literal">POST</tt> request to
<a class="reference external" href="https://tequila.epfl.ch/cgi-bin/tequila/login">https://tequila.epfl.ch/cgi-bin/tequila/login</a>. The body of the <tt class="docutils literal">POST</tt>
request contains the following parameters:</p>
<blockquote>
<ul class="simple">
<li><tt class="docutils literal">requestkey</tt>, whose value is the <tt class="docutils literal">authentication token</tt> received from the Sweng2012QuizApp
server in Step 2</li>
<li><tt class="docutils literal">username</tt>, whose value is the <tt class="docutils literal">username</tt> entered by the
user</li>
<li><tt class="docutils literal">password</tt>, whose value is the <tt class="docutils literal">password</tt> entered by the
user</li>
</ul>
</blockquote>
<p>To specify these parameters in the <tt class="docutils literal">POST</tt> request, you can use a list of <a class="reference external" href="http://developer.android.com/reference/org/apache/http/NameValuePair.html">NameValuePair</a>, create a <a class="reference external" href="http://developer.android.com/reference/org/apache/http/client/entity/UrlEncodedFormEntity.html">UrlEncodedFormEntity</a> from the list, and set it as the <tt class="docutils literal">POST</tt> request's entity using <a class="reference external" href="http://developer.android.com/reference/org/apache/http/client/methods/HttpEntityEnclosingRequestBase.html#setEntity(org.apache.http.HttpEntity)">HttpPost.setEntity</a>.</p>
<p>In <strong>Step 4</strong>, if the <tt class="docutils literal">username</tt> and <tt class="docutils literal">password</tt> match an existing GASPAR account, then authentication succeeds and the Tequila server replies with a <tt class="docutils literal">302</tt> HTTP status
code. Other HTTP status codes (e.g., <tt class="docutils literal">200</tt> or <tt class="docutils literal">400</tt> ) denote unsuccessful authentications.</p>
<p>In <strong>Step 5</strong>, if the authentication is successful, the Sweng2012QuizApp Android application issues a <tt class="docutils literal">POST</tt> request to
the log in functionality of the Sweng2012QuizApp server at <a class="reference external" href="https://sweng-quiz.appspot.com/login">https://sweng-quiz.appspot.com/login</a>. The body of the <tt class="docutils literal">POST</tt> request contains a JSON object whose format
is the following:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">{
  <span style="color: #BA2121">&quot;token&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;rqtvk5d3za2x6ocak1a41dsmywogrdlv5&quot;</span>
}
</pre></div>
<p>The token is the <tt class="docutils literal">authentication token</tt> received from the server in Step 2. The purpose of this message is to tell the Sweng2012QuizApp server that the user has successfully authenticated to the Tequila server. The Sweng2012QuizApp server then verifies that the token received from the user is a valid token.</p>
<p>If the authentication is not successful (e.g., the Tequila server replied with a <tt class="docutils literal">200</tt> or <tt class="docutils literal">400</tt> HTTP status code), the authentication process stops and must be restarted from Step 1, i.e., the application must ask for a new <tt class="docutils literal">authentication token</tt> from the Sweng2012QuizApp server.</p>
<p>In <strong>Step 6</strong>, the Sweng2012QuizApp server replies to the previous <tt class="docutils literal">POST</tt> request
with a <tt class="docutils literal">session id</tt>. The format of the reply from the server is the
following.</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">{
  <span style="color: #BA2121">&quot;session&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;&lt;random_string&gt;&quot;</span>,
  <span style="color: #BA2121">&quot;message&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;Here&#39;s your session id. Please include the following HTTP</span>
<span style="color: #BA2121">              header in your subsequent requests:\n</span>
<span style="color: #BA2121">              Authorization: Tequila &lt;random_string&gt;&quot;</span>
}
</pre></div>
<p>The values of the <tt class="docutils literal">session</tt> field is a random string, generated by the Sweng2012QuizApp server.</p>
<p>If the authentication is not successful, yet you continue the authentication process, the Sweng2012QuizApp server replies with messages similar to the following one (with HTTP status code <tt class="docutils literal">403</tt>):</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">{
  <span style="color: #BA2121">&quot;message&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;The token you specified was invalid.&quot;</span>
}
</pre></div>
<p>In <strong>Step 7</strong>, the Sweng2012QuizApp Android application saves the <tt class="docutils literal">session id</tt>
received from the Sweng2012QuizApp server to local storage. This <tt class="docutils literal">session id</tt>
will be used to authenticate all further communication between your Sweng2012QuizApp application and the Sweng2012QuizApp server.
Since you have to make this <tt class="docutils literal">session id</tt> persistent, you can use
<a class="reference external" href="http://developer.android.com/reference/android/app/Activity.html#getPreferences(int)">Activity.getPreferences(int)</a> to access an <tt class="docutils literal">Activity</tt>'s persistent state.</p>
<p>The <tt class="docutils literal">session id</tt> has no expiry date.</p>
<p>In <strong>Step 8</strong>, the Sweng2012QuizApp Android application allows users to log out by
deleting the saved <tt class="docutils literal">session id</tt>. Re-authenticating users starts from Step 1.</p>
<p>If a request made by the application is malformed in any way, the server
replies with a <tt class="docutils literal">400</tt> HTTP status code and a message.</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">{
 <span style="color: #BA2121">&quot;message&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;Your request was not valid JSON&quot;</span>
}
</pre></div>
<p>The Sweng2012QuizApp server may fail at any point. Therefore, make sure that
the HTTP status code returned after executing a request is the correct
one. The Sweng2012QuizApp Android application should log any unexpected HTTP
status code, using:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Log<span style="color: #666666">.</span><span style="color: #7D9029">e</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;SERVER&quot;</span><span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Replied with status code &quot;</span> <span style="color: #666666">+</span> statusCode<span style="color: #666666">);</span>
</pre></div>
<div class="admonition-grading admonition">
<p class="first admonition-title">Grading</p>
<p>You have to implement all the steps of the authentication process described above. Otherwise, our automated tests will fail and you will lose points.</p>
<p class="last">You have to log all the HTTP status codes of all the requests your app executes. Otherwise, our automated tests will fail and you will lose points.</p>
</div>
</div>
<div class="section" id="the-authentication-activity-5-points">
<h2>2.2. The Authentication Activity (5 points)</h2>
<p>In this part of the homework, you will implement a new <tt class="docutils literal">Activity</tt> that enables users to type in their usernames and passwords and authenticates users with EFPL's Tequila server. The steps to follow are described below.</p>
<p>You have to create a new <tt class="docutils literal">Activity</tt> named <tt class="docutils literal">AuthenticationActivity</tt> in the <tt class="docutils literal">epfl.sweng.authentication</tt> package. This <tt class="docutils literal">Activity</tt> must have the following UI widgets:</p>
<ul class="simple">
<li>A username <tt class="docutils literal">EditText</tt> widget that enables users to enter their username. It must have a hint saying &quot;GASPAR Username&quot;.</li>
<li>A password <tt class="docutils literal">EditText</tt> widget that enables users to enter their password. It must have a hint saying &quot;GASPAR Password&quot;.</li>
<li>A log in <tt class="docutils literal">Button</tt> that, when pressed, initiates the authentication process described in Section 2.1, starting at Step 1, and has the text &quot;Log in using Tequila&quot;.</li>
</ul>
<p>If authentication fails, the <tt class="docutils literal">Activity</tt> must clear the text values of the &quot;GASPAR Username&quot; and the &quot;GASPAR Password&quot; <tt class="docutils literal">EditText</tt> widgets.</p>
<p>If authentication succeeds, the <tt class="docutils literal">Activity</tt> finishes (e.g., by calling <a class="reference external" href="http://developer.android.com/reference/android/app/Activity.html#finish()">Activity.finish</a>) and the <tt class="docutils literal">MainActivity</tt> is displayed to the user.</p>
<div class="admonition-grading admonition">
<p class="first admonition-title">Grading</p>
<p>The <tt class="docutils literal">Activity</tt> that authenticates users must be named <tt class="docutils literal">epfl.sweng.authentication.AuthenticationActivity</tt>.</p>
<p>The UI elements must have the precise hints or text as indicated above, i.e., the username field must have the hint &quot;GASPAR Username&quot;, the password field must have the hint &quot;GASPAR Password&quot;, and the login <tt class="docutils literal">Button</tt> must have the text &quot;Log in using Tequila&quot;.</p>
<p>If there is even the slightest difference in the names or texts, we will not be able to automatically test this part of your homework, and you will lose points.</p>
<p class="last">When the user taps on the login <tt class="docutils literal">Button</tt>, the authentication process should start.</p>
</div>
<div class="admonition-grading admonition">
<p class="first admonition-title">Grading</p>
<p class="last">To receive the points awarded for correctly implementing the authentication process, the <tt class="docutils literal">AuthenticationActivity</tt>'s GUI must be functional. That is, your app must authenticate users with the usernames and passwords they enter in the GUI. Otherwise, we will not be able to automatically test this part of your homework, and you will lose points.</p>
</div>
</div>
<div class="section" id="preventing-unauthorized-access-10-points">
<h2>2.3. Preventing unauthorized access (10 points)</h2>
<p>Now that your app is able to authenticate users against Tequila, it is time to put it to good use: prevent non-EPFL people from taking or creating quizzes. The user should not be able to access any functionality while not being authenticated, except for authentication.</p>
<p>Conceptually, the Sweng2012QuizApp application is in one of two states: <tt class="docutils literal">not authenticated</tt> and <tt class="docutils literal">authenticated</tt>. The way the application
transitions between these two states is defined below:</p>
<blockquote>
<ul class="simple">
<li>Initially, the application is in the <tt class="docutils literal">not authenticated</tt> state.</li>
<li>If authentication is initiated and succeeds, the application moves to
the <tt class="docutils literal">authenticated</tt> state. Otherwise, the application remains in the
<tt class="docutils literal">not authenticated</tt> state.</li>
<li>When the user logs out, the applications moves to the
<tt class="docutils literal">not authenticated</tt> state.</li>
<li>If the user never logs out, the application remains in the <tt class="docutils literal">authenticated</tt> state.</li>
</ul>
</blockquote>
<p>Whenever the Sweng2012QuizApp application is in the <tt class="docutils literal">not authenticated</tt> state,
<tt class="docutils literal">epfl.sweng.entry.MainActivity</tt> should automatically and immediately start the <tt class="docutils literal">epfl.sweng.authentication.AuthenticationActivity</tt>,
so as to prevent unauthenticated users from interacting with the app.</p>
<p>When the Sweng2012QuizApp application is in the <tt class="docutils literal">authenticated</tt> state, the <tt class="docutils literal">MainActivity</tt> displays a list of possible user actions.</p>
</div>
<div class="section" id="storing-the-user-s-credentials-10-points">
<h2>2.4. Storing the user's credentials (10 points)</h2>
<p>Your application must store the <tt class="docutils literal">session id</tt> (received from the Sweng2012QuizApp server in Step 6) to persistent storage.
One way to do it in Android is to use <a class="reference external" href="http://developer.android.com/reference/android/content/SharedPreferences.html">SharedPreferences</a>, which is a named data structure that maps a key to a value. You will use <tt class="docutils literal">SharedPreferences</tt> for this homework.</p>
<p>Here are the constraints on the name and the keys of the <tt class="docutils literal">SharedPreferences</tt> object for storing a user's credentials:</p>
<ul class="simple">
<li>The shared preferences' name must be <tt class="docutils literal">user_session</tt></li>
<li>The key for storing the session id must be <tt class="docutils literal">SESSION_ID</tt></li>
</ul>
<p>The <tt class="docutils literal">session id</tt> must be stored in the shared preferences if and only if
the application is in the <tt class="docutils literal">authenticated</tt> state. That is, whenever the Sweng2012QuizApp app is in the <tt class="docutils literal">authenticated</tt> state, there exists a valid <tt class="docutils literal">session id</tt> that is saved to persistent storage, and whenever the app is in the <tt class="docutils literal">not authenticated</tt> state, there is no <tt class="docutils literal">session id</tt> saved to persistent storage.</p>
<p>A valid <tt class="docutils literal">session id</tt> has no expiry date.</p>
<div class="admonition-grading admonition">
<p class="first admonition-title">Grading</p>
<p>The name of the shared preference and the name of the key must be precisely the ones indicated above: the shared preferences' name must be <tt class="docutils literal">user_session</tt>, and the key for storing the <tt class="docutils literal">session id</tt> must be <tt class="docutils literal">SESSION_ID</tt>.</p>
<p class="last">If there is even the slightest difference, we will not be able to automatically test this part of your homework, and you will lose points.</p>
</div>
</div>
<div class="section" id="performing-authenticated-requests-10-points">
<h2>2.5. Performing authenticated requests (10 points)</h2>
<p>Starting with this homework, all the communication between your app and the Sweng2012QuizApp server will be authenticated. This means that users who do not have a GASPAR account cannot use the app.</p>
<p>To authenticate requests, you have to include the following HTTP header in all your requests: <tt class="docutils literal">Authorization: Tequila &lt;session id&gt;</tt>. You can do this using the <a class="reference external" href="http://developer.android.com/reference/org/apache/http/message/AbstractHttpMessage.html#setHeader(java.lang.String,%20java.lang.String)">AbstractHttpMessage.setHeader</a> method. The header's name is <tt class="docutils literal">Authorization</tt>, and its value is <tt class="docutils literal">Tequila &lt;session id&gt;</tt>.</p>
<div class="admonition-grading admonition">
<p class="first admonition-title">Grading</p>
<p class="last">The server is strict about the header name and format.
If there is even the slightest deviation in your submission, we will not be able to automatically test this part of your homework, and you will lose points.</p>
</div>
<p>If a user is not logged in, yet the application makes a request requiring authentication (which is incorrect as per this homework's specifications),
the server replies with a <tt class="docutils literal">401</tt> HTTP status code and a JSON object containing a message. This serves as debugging aid:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">{
 <span style="color: #BA2121">&quot;message&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;Please log in at /login&quot;</span>
}
</pre></div>
<p>The response contains, in addition to the message above, the
<tt class="docutils literal"><span class="pre">WWW-Authenticate:</span> Tequila <span class="pre">realm=&quot;sweng2012&quot;</span></tt> header. This is not
used, but the HTTP specification requires such headers for <tt class="docutils literal">401</tt>
responses.</p>
</div>
<div class="section" id="changes-to-the-graphical-user-interface-5-points">
<h2>2.6. Changes to the Graphical User Interface (5 points)</h2>
<p>When the application is in the <tt class="docutils literal">authenticated</tt> state, <tt class="docutils literal">MainActivity</tt> displays a list of possible user actions.
Your <tt class="docutils literal">MainActivity</tt> must have all the <tt class="docutils literal">Button</tt> UI widgets from Homework #2 and an additional <tt class="docutils literal">Button</tt> to enable users to log out as described above. This <tt class="docutils literal">Button</tt> must have the text set to &quot;Log out&quot;. Upon clicking this button, the application immediately transits to the <tt class="docutils literal">not authenticated</tt> state and launches the <tt class="docutils literal">epfl.sweng.authentication.AuthenticationActivity</tt>.</p>
<div class="admonition-grading admonition">
<p class="first admonition-title">Grading</p>
<p class="last">The <tt class="docutils literal">Button</tt> that enables the users to log out must have the text &quot;Log out&quot;.
All the buttons from Homework #2 must be present and have the same functionality as in that homework.
If there is even the slightest text difference, we will not be able to automatically test this part of your homework, and you will lose points.</p>
</div>
</div>
</div>
<div class="section" id="full-track-code-coverage-30-points">
<h1>3. [Full Track] Code Coverage (30 points)</h1>
<p>Now that you have implemented the basic track for this homework,
it is time to make sure that your code is reliable. You will check
this by writing unit tests for your application. The goal for the
tests you write is to achieve <strong>80%</strong> code coverage for the code
you wrote so far for <strong>Homework #1, Homework #2, and Homework #3</strong>.</p>
<p>Only the code coverage generated by the tests that pass counts toward the 80% code coverage goal.
So, if you achieve 80% coverage, yet none of your tests pass, you will receive 0 points for this part of the homework.</p>
<p>Your tests should take less than 10 minutes to finish running. After the 10 minutes run out, Jenkins will stop running your tests.</p>
<div class="admonition-grading admonition">
<p class="first admonition-title">Grading</p>
<p>Your tests may only use the default testing features provided by the
Android SDK or Robotium 3.4.1. See Homework #1 for the details.</p>
<p>The number of points will be computed using the same rules as in Homework #1, i.e.,
with the following formula:</p>
<blockquote>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">30 * min<span style="color: #666666">(</span>1, <span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">${</span><span style="color: #19177C">CODE_COVERAGE</span><span style="color: #008000; font-weight: bold">}</span>/80<span style="color: #666666">)</span>^2<span style="color: #666666">)</span>
</pre></div>
</blockquote>
<p class="last">In other words, your tests must achieve 80% line coverage for the entire code
base of your application in order for you to get the full points for this part of the homework.</p>
</div>
</div>
<div class="section" id="final-checklist">
<h1>4. Final Checklist</h1>
<p>Grading for this homework will be completely automated. This means that your
homework's project structure, code, package names, button labels, <tt class="docutils literal">Activity</tt>
names, etc., must conform to the following rules. Otherwise, our servers will not be able to
automatically grade your homework, and you will lose points.</p>
<p>Here is a recap of the most important rules your homework must obey:</p>
<ul>
<li><p class="first">Rules set in Homework #1 and Homework #2 regarding the project structure still apply</p>
</li>
<li><p class="first">Your <tt class="docutils literal">${REPO}</tt> must have the following folder structure:</p>
<pre class="literal-block">
${REPO}
├── Sweng2012Sweng2012QuizApp
|&nbsp;&nbsp; ├── assets
|&nbsp;&nbsp; ├── libs
|&nbsp;&nbsp; ├── res
|&nbsp;&nbsp; └── src
| &nbsp;     └── epfl
|&nbsp;&nbsp;         └── sweng
|               ├── editquestions
|               |   └── EditQuestionActivity.java
|               ├── entry
|               |   └── MainActivity.java
|               ├── quizquestions
|               |   └── QuizQuestion.java
|               ├── showquestions
|               |   └── ShowQuestionsActivity.java
|               └── authentication
|                   └── AuthenticationActivity.java
└── Sweng2012Sweng2012QuizAppTest
 &nbsp;&nbsp; ├── assets
 &nbsp;&nbsp; ├── libs
 &nbsp;&nbsp; ├── res
 &nbsp;&nbsp; └── src
 &nbsp;&nbsp;     └── epfl
 &nbsp;&nbsp;         └── sweng
                └── test
</pre>
</li>
<li><p class="first">You can have additional classes in the <tt class="docutils literal">epfl.sweng</tt> package</p>
</li>
<li><p class="first">The following command must fully compile and install your app in an emulator:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #19177C">$ </span><span style="color: #008000">cd</span> <span style="color: #008000; font-weight: bold">${</span><span style="color: #19177C">REPO</span><span style="color: #008000; font-weight: bold">}</span>/Sweng2012Sweng2012QuizApp
<span style="color: #19177C">$ </span>ant clean debug install
</pre></div>
</li>
<li><p class="first">The following command must run your installed app on an emulator:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #19177C">$ </span>adb shell am start -a android.intent.action.MAIN -n epfl.sweng/.entry.MainActivity
</pre></div>
</li>
<li><p class="first">The following command must compile and run all your tests:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #19177C">$ </span><span style="color: #008000">cd</span> <span style="color: #008000; font-weight: bold">${</span><span style="color: #19177C">REPO</span><span style="color: #008000; font-weight: bold">}</span>/Sweng2012Sweng2012QuizAppTest
<span style="color: #19177C">$ </span>ant clean emma debug install <span style="color: #008000">test</span>
</pre></div>
</li>
<li><p class="first">The rules defined in Homework #1 for accessing the network still apply</p>
</li>
<li><p class="first">Your code must be committed to the <tt class="docutils literal"><span class="pre">https://github.com/dslab-epfl/&lt;reponame&gt;.git</span></tt>
git repository, where <tt class="docutils literal">&lt;reponame&gt;</tt> is the name of your team's repository</p>
</li>
</ul>
</div>
</div>
</body>
</html>
